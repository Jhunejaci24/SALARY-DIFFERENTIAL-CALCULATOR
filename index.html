<!DOCTYPE html>
<html lang="en">
<head>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7586964259112540"
    crossorigin="anonymous"></script>

<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Salary Promotion Calculator</title>
<style>
body { font-family: Arial, sans-serif; background:#f8f9fa; margin:0; padding:0; }
.container { max-width:600px; margin:40px auto; background: linear-gradient(-45deg,  #0000ff, #ffff00, #ff0000); padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
label { display:block; margin-top:10px; }
input { width:95%; padding:8px; margin-top:5px; }
button { margin-top:15px; padding:10px 20px; border:none; background:#007bff; color:white; border-radius:6px; cursor:pointer; }
button:hover { background:#0056b3; }
#resultSection { display:none; }
#trancheFields { display:none; }
h2 { text-align:center; color:black; }
.result-box { background:#eef; padding:15px; border-radius:8px; margin-top:10px; }
.right-align { text-align:right; display:block; }
.underline { text-decoration: underline; }
.double-underline { text-decoration: underline double; }

table { width:100%; border-collapse:collapse; margin-top:15px; text-align:right; }
th, td { border:1px solid #ccc; padding:6px; }
th { background:#007bff; color:white; text-align:center; }
tr:nth-child(5) { font-weight:bold; background:#eef; }
</style>
</head>
<body>
<div class="container" id="entrySection">
  <h2>Salary Differential Calculator</h2>
  <label>Name:</label><input type="text" id="name">
  <label>Position:</label><input type="text" id="position">
  <label>Address:</label><input type="text" id="address">
  <label>Tin Number:</label><input type="number" id="tin">
  <label>Bank Name & Account Number:</label><input type="text" id="account">
  <label>Previous Salary:</label><input type="number" id="prevSalary">
  <label>New Salary:</label><input type="number" id="newSalary">
  <label>Number of Absences 1:</label><input type="number" id="absences1">
  <label>Date of Promotion:</label> <input type="date" id="promotionDate">
  <label>Date of Salary Integrated:</label> <input type="date" id="integratedDate">

  <div id="trancheFields">
    <label>Old Salary Tranche:</label><input type="number" id="oldTranche">
    <label>New Salary Tranche:</label><input type="number" id="newTranche">
    <label>Number of Absences 2:</label><input type="number" id="absences2">
  </div>
  <button onclick="compute()">Compute</button>
</div>

<div class="container" id="resultSection" style="position:relative;">
  <h2>Result</h2>
  
  <!-- Right-side Teacher's DV button -->
  <button onclick="goDV()" style="
    position:absolute;
    top:20px;
    right:-150px;
    width:150px;                              
    background:#007bff;
    color:white;
    border:none;
    border-radius:6px;
    padding:10px 18px;
    cursor:pointer;
    font-weight:bold;
  ">Teacher's DV</button>
  
<button onclick="goGSISDV()" style="
    position:absolute;
    top:70px;
    right:-150px;
    width:150px;                                
    background:#28a745;
    color:white;
    border:none;
    border-radius:6px;
    padding:10px 18px;
    cursor:pointer;
    font-weight:bold;
  ">GSIS DV</button>

<button onclick="goPHILHEALTHDV()" style="
    position:absolute;
    top:120px;
    right:-150px;
    width:150px;                                
    background:#007bff;
    color:white;
    border:none;
    border-radius:6px;
    padding:10px 18px;
    cursor:pointer;
    font-weight:bold;
  ">Philhealth DV</button>

<button onclick="goPAYROLL()" style="
    position:absolute;
    top:170px;
    right:-150px;
    width:150px;                                
    background:#28a745;
    color:white;
    border:none;
    border-radius:6px;
    padding:10px 18px;
    cursor:pointer;
    font-weight:bold;
  ">PAYROLL</button>

<button onclick="goORS()" style="
    position:absolute;
    top:220px;
    right:-150px;
    width:150px;                                
    background:#007bff;
    color:white;
    border:none;
    border-radius:6px;
    padding:10px 18px;
    cursor:pointer;
    font-weight:bold;
  ">ORS</button>

<button onclick="goORSSalary()" style="
    position:absolute;
    top:270px;
    right:-180px;
    width:200px;                                
    background:#28a745;
    color:white;
    border:none;
    border-radius:6px;
    padding:10px 18px;
    cursor:pointer;
    font-weight:bold;
">ORS SALARY AND PHILHEALTH</button>

  <div class="result-box" id="result"></div>

  <div style="text-align:center; margin-top:10px;">
    <button onclick="edit()">Edit</button>
    <button onclick="window.print()">Print</button>
    <button onclick="goNext()">Next</button>
  </div>
</div>




<script>
function adjustPromotionDate(date) {
  const d = new Date(date);
  const day = d.getDay();
  if(day === 6) d.setDate(d.getDate() + 2);
  else if(day === 0) d.setDate(d.getDate() + 1);
  return d;
}

function passedWorkdays(adjustedDate) {
  const year = adjustedDate.getFullYear();
  const month = adjustedDate.getMonth();
  const day = adjustedDate.getDate();
  let count = 0;
  for(let i=1; i<day; i++){
    const temp = new Date(year, month, i);
    const wd = temp.getDay();
    if(wd !== 0 && wd !== 6) count++;
  }
  return count;
}

function formatCurrency(num) {
  return num.toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2});
}

function checkTrancheVisibility() {
  const promo = new Date(document.getElementById('promotionDate').value);
  const integ = new Date(document.getElementById('integratedDate').value);
  if (!isNaN(promo) && !isNaN(integ)) {
    const show = integ.getFullYear() === promo.getFullYear() + 1;
    document.getElementById('trancheFields').style.display = show ? 'block' : 'none';
  }
}
document.getElementById('promotionDate').addEventListener('change', checkTrancheVisibility);
document.getElementById('integratedDate').addEventListener('change', checkTrancheVisibility);

function edit() {
  document.getElementById('entrySection').style.display = 'block';
  document.getElementById('resultSection').style.display = 'none';
}

function compute() {
  const name = document.getElementById('name').value;
  const position = document.getElementById('position').value;
  const address = document.getElementById('address').value;
  const tin = document.getElementById('tin').value;
  const account = document.getElementById('account').value;
  const prevSalary = parseFloat(document.getElementById('prevSalary').value);
  const newSalary = parseFloat(document.getElementById('newSalary').value);
  const promotionDate = document.getElementById('promotionDate').value;
  const integratedDate = document.getElementById('integratedDate').value;
  const abs1 = parseFloat(document.getElementById('absences1').value) || 0;
  const abs2 = parseFloat(document.getElementById('absences2').value) || 0;

  if (!name || !position || isNaN(prevSalary) || isNaN(newSalary) || !promotionDate || !integratedDate) {
    alert("Please fill all fields correctly.");
    return;
  }

  const r2 = (num) => Math.round(num * 100) / 100;
  const formatCurrency = (num) => num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

  const diff = r2(newSalary - prevSalary);
  const adjustedDate = adjustPromotionDate(promotionDate);
  const passed = passedWorkdays(adjustedDate);
  const networkDays = 22 - passed;
  const partialPay = r2((networkDays * diff) / 22);

  const promo = new Date(promotionDate);
  const integ = new Date(integratedDate);
  const startSuccDate = new Date(promo.getFullYear(), promo.getMonth() + 1, 1);
  let succMonths = 0;
  let endSuccDate = integ;

  if (promo.getFullYear() === integ.getFullYear()) {
    succMonths = integ.getMonth() - promo.getMonth();
    endSuccDate = new Date(integ.getFullYear(), integ.getMonth(), integ.getDate());
  } else if (promo.getFullYear() < integ.getFullYear()) {
    succMonths = 11 - promo.getMonth();
    endSuccDate = new Date(promo.getFullYear(), 11, 31);
  }
  if (succMonths < 0) succMonths = 0;

  const succPay = r2(succMonths * diff);
  const showC = succPay > 0;
  const succPayLine = showC
    ? `<b>C.</b> ${startSuccDate.toLocaleDateString()} - ${endSuccDate.toLocaleDateString()}: ${succMonths} Ã— â‚±${formatCurrency(diff)} = â‚±${formatCurrency(succPay)}<br>`
    : "";

  const oldTranche = parseFloat(document.getElementById('oldTranche').value);
  const newTranche = parseFloat(document.getElementById('newTranche').value);
  const trancheDiff = r2(newTranche - oldTranche);
  const showA1 = !isNaN(trancheDiff) && trancheDiff !== 0;
  const a1Line = showA1
    ? `<b>A.1</b> â‚±${formatCurrency(newTranche)} âˆ’ â‚±${formatCurrency(oldTranche)} = â‚±${formatCurrency(trancheDiff)}<br>`
    : "";

  // ðŸŸ© D. Tranche computation with D.1 & D.2 logic
  let tranchePay = 0, tranchePayLine = "", trancheGS = 0, trancheGSLine = "";
  let d1 = 0, d2 = 0;

  // ðŸŸ© D. computation with D.1 and D.2 fix
let trancheStart = new Date(integ.getFullYear(), 0, 1);
let trancheEnd = new Date(integ);
let trancheMonths = integ.getMonth() + 1;
let dLines = "";

// Always compute D.1 kahit walang tranche
d1 = r2((diff / 22) * (abs1 || 0));

// Compute D.2 kung applicable
if (!isNaN(oldTranche) && !isNaN(newTranche)) {
  d2 = r2((trancheDiff / 22) * (abs2 || 0));
}

// Display D.1 / D.2 kung may laman
if (d1 > 0) dLines += `<b>D.1</b> Absences1: â‚±${formatCurrency(d1)}<br>`;
if (d2 > 0) dLines += `<b>D.2</b> Absences2: â‚±${formatCurrency(d2)}<br>`;

// Compute tranche only if condition applies
if (integ.getFullYear() === promo.getFullYear() + 1 && !isNaN(oldTranche) && !isNaN(newTranche)) {
  tranchePay = r2(trancheMonths * trancheDiff);
  trancheGS = r2(trancheMonths * trancheDiff);

  tranchePayLine = `
    <b>D.</b> ${trancheStart.toLocaleDateString()} - ${trancheEnd.toLocaleDateString()}: ${trancheMonths} Ã— â‚±${formatCurrency(trancheDiff)} = â‚±${formatCurrency(tranchePay)}<br>
    ${dLines}
  `;

  trancheGSLine = `<b>G.</b> ${trancheStart.toLocaleDateString()} - ${trancheEnd.toLocaleDateString()}: ${trancheMonths} Ã— â‚±${formatCurrency(trancheDiff)} = â‚±${formatCurrency(trancheGS)}<br>`;
} else if (d1 > 0) {
  // kung walang tranche pero may D.1
  tranchePayLine = `${dLines}`;
}


  const totalPS = r2(partialPay + succPay + tranchePay-d1-d2);
  const lastDayOfMonth = new Date(promo.getFullYear(), promo.getMonth() + 1, 0);
  const daysInMonth = lastDayOfMonth.getDate();
  const dateDiff = lastDayOfMonth.getDate() - promo.getDate();
  const gsPartialDays = daysInMonth - (daysInMonth - dateDiff - 1);
  const gsM = r2((gsPartialDays * diff) / daysInMonth);
  const gsSuccPay = r2(succMonths * diff);
  const showF = gsSuccPay > 0;
  const fLine = showF ? `<b>F.</b> ${startSuccDate.toLocaleDateString()} - ${endSuccDate.toLocaleDateString()}: ${succMonths} Ã— â‚±${formatCurrency(diff)} = â‚±${formatCurrency(gsSuccPay)}<br>` : "";
  const totalGS = r2(gsM + gsSuccPay + trancheGS);

  // ðŸŸ© COMPUTATION TABLE
  const onePS1 = r2(gsM * 0.09);
  const oneGS1 = r2(gsM * 0.12);
  const onePHILC1 = r2((partialPay - d1) * 0.025);
  const MPS1 = onePS1, MGS1 = oneGS1, MPHILC1 = onePHILC1;

  const onePS2 = r2(gsSuccPay * 0.09);
  const oneGS2 = r2(gsSuccPay * 0.12);
  const onePHILC2 = r2(succPay * 0.025);
  const monthsF = succMonths || 1;
  const MPS2 = r2(onePS2 / monthsF);
  const MGS2 = r2(oneGS2 / monthsF);
  const MPHILC2 = r2(onePHILC2 / monthsF);

  const onePS3 = r2(trancheGS * 0.09);
  const oneGS3 = r2(trancheGS * 0.12);
  const onePHILC3 = r2((tranchePay - d2) * 0.025);
  const monthsG = (integ.getMonth() + 1) || 1;
  const MPS3 = r2(onePS3 / monthsG);
  const MGS3 = r2(oneGS3 / monthsG);
  const MPHILC3 = r2(onePHILC3 / monthsG);

  const totalPSsum = r2(onePS1 + onePS2 + onePS3);
  const totalGSsum = r2(oneGS1 + oneGS2 + oneGS3);
  const totalPHILCsum = r2(onePHILC1 + onePHILC2 + onePHILC3);
  const totalMPSsum = r2(MPS1 + MPS2 + MPS3);
  const totalMGSsum = r2(MGS1 + MGS2 + MGS3);
  const totalMPHILCsum = r2(MPHILC1 + MPHILC2 + MPHILC3);

  const tableHTML = `
  <table border="1" style="border-collapse:collapse; text-align:center; margin-top:10px; width:100%;">
    <tr><th>1PS</th><th>1GS</th><th>1PHILC</th><th>MPS</th><th>MGS</th><th>MPHILC</th></tr>
    <tr><td>${formatCurrency(onePS1)}</td><td>${formatCurrency(oneGS1)}</td><td>${formatCurrency(onePHILC1)}</td><td>${formatCurrency(MPS1)}</td><td>${formatCurrency(MGS1)}</td><td>${formatCurrency(MPHILC1)}</td></tr>
    <tr><td>${formatCurrency(onePS2)}</td><td>${formatCurrency(oneGS2)}</td><td>${formatCurrency(onePHILC2)}</td><td>${formatCurrency(MPS2)}</td><td>${formatCurrency(MGS2)}</td><td>${formatCurrency(MPHILC2)}</td></tr>
    <tr><td>${formatCurrency(onePS3)}</td><td>${formatCurrency(oneGS3)}</td><td>${formatCurrency(onePHILC3)}</td><td>${formatCurrency(MPS3)}</td><td>${formatCurrency(MGS3)}</td><td>${formatCurrency(MPHILC3)}</td></tr>
    <tr style="font-weight:bold;"><td>${formatCurrency(totalPSsum)}</td><td>${formatCurrency(totalGSsum)}</td><td>${formatCurrency(totalPHILCsum)}</td><td>${formatCurrency(totalMPSsum)}</td><td>${formatCurrency(totalMGSsum)}</td><td>${formatCurrency(totalMPHILCsum)}</td></tr>
  </table>`;

  // ðŸŸ© Final totals and result display.
  const philhealthPS = r2(totalPS * 0.025);
  const withholding = r2(totalPS * 0.10);
  const ps9 = r2(totalGS * 0.09);
  const totalDeduction = r2(philhealthPS + withholding + ps9);
  const grandTotal = r2(totalPS - totalDeduction);
  const gsis = r2(totalGS * 0.12);
  const philhealthGS = r2(totalPS * 0.025);

  document.getElementById('entrySection').style.display = 'none';
  document.getElementById('resultSection').style.display = 'block';

  document.getElementById('result').innerHTML = `
    <strong>${name}</strong><br>${position}<br><br>
    <b>A.</b> â‚±${formatCurrency(newSalary)} âˆ’ â‚±${formatCurrency(prevSalary)} = â‚±${formatCurrency(diff)}<br>
    ${a1Line}
    <b>B.</b> ${adjustedDate.toLocaleDateString()} âˆ’ ${lastDayOfMonth.toLocaleDateString()}: ${networkDays} days Ã— â‚±${formatCurrency(diff)} Ã· 22 = â‚±${formatCurrency(partialPay)}<br>
    ${succPayLine}${tranchePayLine}
    <span class="right-align">Total PS: â‚±${formatCurrency(totalPS)}</span><br>
    <b>GS Calculation:</b><br>
    <b>E.</b> ${adjustedDate.toLocaleDateString()} âˆ’ ${lastDayOfMonth.toLocaleDateString()}: ${gsPartialDays} Ã— â‚±${formatCurrency(diff)} Ã· ${daysInMonth} = â‚±${formatCurrency(gsM)}<br>
    ${fLine}${trancheGSLine}
    <b>Total GS:</b> â‚±${formatCurrency(totalGS)}<br><br>
    <b>Deductions:</b><br>
    2.5% PhilHealth PS: â‚±${formatCurrency(philhealthPS)}<br>
    10% Withholding Tax: â‚±${formatCurrency(withholding)}<br>
    9% PS (Ã— Total GS): â‚±${formatCurrency(ps9)}<br><br>
    <span class="right-align underline">(Total Deduction): â‚±${formatCurrency(totalDeduction)}</span><br>
    <span class="right-align double-underline">Grand Total: â‚±${formatCurrency(grandTotal)}</span><br><br>
    <b>Additional:</b><br>
    12% GSIS: â‚±${formatCurrency(gsis)}<br>
    2.5% PhilHealth GS: â‚±${formatCurrency(philhealthGS)}<br><br>
    ${tableHTML}
  `;
// ðŸŸ¦ Send computed data to Teacher's DV
localStorage.setItem("dv_name", name);
localStorage.setItem("dv_position", position);
localStorage.setItem("dv_address", address);
localStorage.setItem("dv_tin", tin);
localStorage.setItem("dv_account", account);
localStorage.setItem("dv_total_ps", totalPS.toFixed(2));        // Total PS
localStorage.setItem("dv_gsis", gsis.toFixed(2));                // 12% GSIS
localStorage.setItem("dv_philhealth_ps", philhealthPS.toFixed(2)); // 2.5% PhilHealth PS
localStorage.setItem("dv_philhealth_gs", philhealthPS.toFixed(2)); // âœ… same as PS
localStorage.setItem("dv_withholding", withholding.toFixed(2));  // 10% Withholding
localStorage.setItem("dv_ps9", ps9.toFixed(2)); // ðŸŸ© save 9% PS value
localStorage.setItem("dv_total_deduction", totalDeduction.toFixed(2));
}


function goNext() { window.location.href = "nextPage.html"; }
function goAdmin() { window.location.href = "adminPanel.html"; }
</script>
<script>
function goDV() {
  // âœ… Mark that the DV data is ready
  localStorage.setItem("dv_ready", "true");

  // âœ… Go to teachers DV page (same folder)
  window.location.href = "teachers dv.html";
}
</script>
<script>
function goGSISDV() {
  // âœ… Mark GSIS DV data ready
  localStorage.setItem("dv_type", "gsis");
  localStorage.setItem("dv_ready", "true");
  window.location.href = "gsis dv.html";
}
</script>
<script>
function goPHILHEALTHDV() {
  // âœ… Mark PHILHEALTH DV data ready
  localStorage.setItem("dv_type", "philhealth");
  localStorage.setItem("dv_ready", "true");
  window.location.href = "philhealth dv.html";
}
</script>
<script>
function goPAYROLL() {
  // âœ… Mark PAYROLL data ready
  localStorage.setItem("dv_type", "payroll");
  localStorage.setItem("dv_ready", "true");
  window.location.href = "payroll.html";
}
</script> 
<script>
function sendToPayroll() {
  // âœ… Store employee info from calculator
  localStorage.setItem("dv_ready", "true");
  localStorage.setItem("dv_name", document.getElementById("name").value);
  localStorage.setItem("dv_position", document.getElementById("position").value);
  localStorage.setItem("dv_account", document.getElementById("account").value);

  // âœ… Store computed values (including GSIS & PHIC)
  localStorage.setItem("dv_total_ps", localStorage.getItem("dv_total_ps"));
  localStorage.setItem("dv_gsis", localStorage.getItem("dv_gsis"));                 // 12% GSIS GS
  localStorage.setItem("dv_ps9", localStorage.getItem("dv_ps9"));                   // 9% GSIS PS
  localStorage.setItem("dv_philhealth_ps", localStorage.getItem("dv_philhealth_ps"));// 2.5% PHIC PS
  localStorage.setItem("dv_philhealth_gs", localStorage.getItem("dv_philhealth_ps"));// 2.5% PHIC GS âœ… added
  localStorage.setItem("dv_withholding", localStorage.getItem("dv_withholding"));
  localStorage.setItem("dv_total_deduction", totalDeduction.toFixed(2));
  localStorage.setItem("dv_grand_total", grandTotal.toFixed(2));

  localStorage.setItem("ors_gsis", GSIS);


  alert("Payroll data ready. Opening payroll form...");
  window.open("payroll.html", "_blank");
}
</script>
<script>
// Load history from localStorage
let historyData = JSON.parse(localStorage.getItem("historyData") || "{}");

// Get all inputs
const allInputs = document.querySelectorAll("#entrySection input");

// Save current form data keyed by Name
function saveHistoryByName() {
  const name = document.getElementById("name").value.trim();
  if (!name) return;

  historyData[name] = {};
  allInputs.forEach(input => {
    historyData[name][input.id] = input.value;
  });

  localStorage.setItem("historyData", JSON.stringify(historyData));
}

// Create datalist for Name field
function createNameDatalist() {
  let datalistId = "name-list";
  let nameInput = document.getElementById("name");

  if (!document.getElementById(datalistId)) {
    const dl = document.createElement("datalist");
    dl.id = datalistId;
    document.body.appendChild(dl);
    nameInput.setAttribute("list", datalistId);
  }

  const dl = document.getElementById(datalistId);
  dl.innerHTML = "";
  Object.keys(historyData).forEach(name => {
    const opt = document.createElement("option");
    opt.value = name;
    dl.appendChild(opt);
  });
}

// Auto-fill all fields when Name changes
document.getElementById("name").addEventListener("change", () => {
  const name = document.getElementById("name").value.trim();
  if (historyData[name]) {
    Object.keys(historyData[name]).forEach(id => {
      const input = document.getElementById(id);
      if (input) input.value = historyData[name][id];
    });
  }
});

// Initialize datalist for Name field on page load
createNameDatalist();

// Save all fields when Compute is clicked
document.querySelector("button[onclick='compute()']").addEventListener("click", () => {
  saveHistoryByName();
  createNameDatalist();
});

function goORS() {
  // Kunin ang GSIS na na-compute
  const gsisAmount = localStorage.getItem("dv_gsis") || "0.00";

  // I-save sa localStorage para ma-access sa ORS.html
  localStorage.setItem("ors_gsis", gsisAmount);

  // Buksan ang ORS page
  window.location.href = "ORS.html";
}

</script>
<script>
function goORSSalary() {
  // Kunin ang mga values sa Salary Computation page
  const name = document.getElementById("name")?.value || "";
  const address = document.getElementById("address")?.value || "";

  // Kunin ang mga halaga mula sa localStorage (na galing sa DV computation)
  const totalPS = parseFloat(localStorage.getItem("dv_total_ps")) || 0;
  const phil = parseFloat(localStorage.getItem("dv_philhealth_ps")) || 0;

  // I-save sa localStorage para mabasa ng ORS SALARY AND PHIL HEALTH.html
  localStorage.setItem("ors_name", name);
  localStorage.setItem("ors_address", address);
  localStorage.setItem("ors_totalPS", totalPS);
  localStorage.setItem("ors_philhealth", phil);

  // Redirect papunta sa ORS SALARY AND PHIL HEALTH.html
  window.location.href = "ORS SALARY AND PHIL HEALTH.html";
}
</script>

<!-- Modern Footer Section -->
<footer style="
    text-align:center; 
    margin-top:40px; 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
    font-size:15px;
">
    <p style="margin:5px 0;">Developed by: <strong>Romulo J. Jacinto Jr.</strong></p>
    <p style="margin:2px 0;"><strong>Administrative Officer II</strong></p>  
    <p style="margin:5px 0;">Alright Reserve 2025</p>
</footer>

<style>
@media print {
    footer {
        display: none; /* hide footer when printing */
    }
}
</style>


</body>
</html>

